<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:x="http://myfaces.apache.org/tomahawk"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:o="http://omnifaces.org/ui"
    xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites"
    xmlns:zlb="http://xmlns.jcp.org/jsf/composite/composites"
    xmlns:jsf="http://xmlns.jcp.org/jsf">

    <composite:interface>
    </composite:interface>

    <composite:implementation>

        <h2 class="page__heading">
            <h:outputText
                rendered="#{externalLoginBean.wizzardMode=='page1' or externalLoginBean.wizzardMode=='confirm'}"
                value="#{msgs.plugin_rest_usercreation_new_account}" />
            <h:outputText
                rendered="#{externalLoginBean.wizzardMode=='page2'}"
                value="#{msgs.plugin_rest_usercreation_new_institution}" />
            <h:outputText
                rendered="#{externalLoginBean.wizzardMode=='page3'}"
                value="#{msgs.plugin_rest_usercreation_new_contact}" />
            <h:outputText
                rendered="#{externalLoginBean.wizzardMode=='page4'}"
                value="#{msgs.plugin_rest_usercreation_new_additionalData}" />
            <h:outputText
                rendered="#{externalLoginBean.wizzardMode=='page5'}"
                value="#{msgs.plugin_rest_usercreation_new_activation}" />
            <h:outputText
                rendered="#{externalLoginBean.wizzardMode=='wait'}"
                value="#{msgs.plugin_rest_usercreation_new_account_creationSuccessfulHeading}" />
            <button
                type="button"
                class="btn page__help"
                aria-label="#{msgs.plugin_rest_usercreation_ariaLabel_pageHelp}"
                data-bs-toggle="modal"
                data-bs-title="help title"
                data-bs-target="#pageHelpModal">
                <ui:include src="/uii/includes/icon-help.xhtml" />
            </button>
        </h2>


        <ui:fragment rendered="#{externalLoginBean.wizzardMode=='page1'}">

            <section class="common-region">
                <!-- account name -->
                <div class="form #{!externalLoginBean.accountNameValid ? 'validate--danger' : ''}">

                    <zlb:label
                        labelFor="accountName"
                        labelText="#{msgs.plugin_rest_usercreation_userName}"
                        labelRequired="true" />

                    <x:inputText
                        id="accountName"
                        pt:aria-label="#{msgs.plugin_rest_usercreation_userName}"
                        styleClass="form-control"
                        value="#{externalLoginBean.accountName}">
                        <f:ajax
                            render="@this"
                            execute="@this" />
                        <f:passThroughAttribute
                            name="placeholder"
                            value="#{msgs.plugin_rest_usercreation_new_account_placeholder_accountName}" />
                    </x:inputText>
                    <!-- ICONS -->
                    <ui:include src="/uii/includes/form_icons.xhtml">
                        <ui:param
                            name="helpTitle"
                            value="#{msgs.plugin_rest_usercreation_new_account_userName}" />
                        <ui:param
                            name="helpBody"
                            value="#{msgs.plugin_rest_usercreation_helpText_userName}" />
                    </ui:include>
                    <h:panelGroup
                        layout="block"
                        rendered="#{!externalLoginBean.accountNameValid}"
                        styleClass="font-danger validation-message">
                        <h:outputText value="#{externalLoginBean.accountNameErrorMessage}" />
                    </h:panelGroup>
                </div>

                <!-- firstname -->
                <div class="form column-start #{!externalLoginBean.firstNameValid ? 'validate--danger' : ''}">
                    <zlb:label
                        labelFor="firstname"
                        labelText="#{msgs.firstname}"
                        labelRequired="true" />

                    <zlb:input
                        inputId="firstname"
                        inputAriaLabel="#{msgs.firstname}"
                        inputValue="#{externalLoginBean.firstname}"
                        inputRequired="false"
                        inputPlaceholder="#{msgs.firstname}"
                        helpTitle="#{msgs.firstname}"
                        helpText="#{msgs.plugin_rest_usercreation_helpText_firstname}" />

                    <h:panelGroup
                        layout="block"
                        rendered="#{!externalLoginBean.firstNameValid}"
                        styleClass="font-danger validation-message">
                        <h:outputText value="#{externalLoginBean.firstNameErrorMessage}" />
                    </h:panelGroup>

                </div>

                <!-- lastname -->
                <div class="form #{!externalLoginBean.lastNameValid ? 'validate--danger' : ''}">
                    <zlb:label
                        labelFor="lastname"
                        labelText="#{msgs.lastname}"
                        labelRequired="true" />

                    <zlb:input
                        inputId="lastname"
                        inputAriaLabel="#{msgs.lastname}"
                        inputValue="#{externalLoginBean.lastname}"
                        inputRequired="false"
                        inputPlaceholder="#{msgs.lastname}"
                        showHelpBtn="true"
                        helpTitle="#{msgs.lastname}"
                        helpText="#{msgs.plugin_rest_usercreation_helpText_lastname}" />
                    <h:panelGroup
                        layout="block"
                        rendered="#{!externalLoginBean.lastNameValid}"
                        styleClass="font-danger validation-message">
                        <h:outputText value="#{externalLoginBean.lastNameErrorMessage}" />
                    </h:panelGroup>
                </div>

                <!-- password -->
                <div class="form #{!externalLoginBean.passwordValid ? 'validate--danger' : ''}">

                    <zlb:label
                        labelFor="password"
                        labelText="#{msgs.plugin_rest_usercreation_new_account_password}"
                        labelRequired="true" />

                    <x:inputSecret
                        id="password"
                        pt:aria-label="#{msgs.plugin_rest_usercreation_new_account_password}"
                        forceId="true"
                        styleClass="form-control"
                        value="#{externalLoginBean.password}"
                        required="false">
                        <f:passThroughAttribute
                            name="placeholder"
                            value="" />
                    </x:inputSecret>

                    <!-- Icons -->
                    <ui:include src="/uii/includes/form_icons.xhtml">
                        <ui:param
                            name="helpTitle"
                            value="#{msgs.plugin_rest_usercreation_new_account_password}" />
                        <ui:param
                            name="helpBody"
                            value="#{msgs.plugin_rest_usercreation_helpText_password}" />
                    </ui:include>

                    <h:panelGroup
                        layout="block"
                        rendered="#{!externalLoginBean.passwordValid}"
                        styleClass="font-danger validation-message">
                        <h:outputText value="#{externalLoginBean.passwordErrorMessage}" />
                    </h:panelGroup>
                </div>

                <!-- confirm password -->
                <div class="form #{!externalLoginBean.passwordValid ? 'validate--danger' : ''}">

                    <zlb:label
                        labelFor="password2"
                        labelText="#{msgs.plugin_rest_usercreation_new_account_password2}"
                        labelRequired="true" />

                    <x:inputSecret
                        id="password2"
                        pt:aria-label="#{msgs.plugin_rest_usercreation_new_account_password2}"
                        forceId="true"
                        styleClass="form-control"
                        value="#{externalLoginBean.confirmPassword}"
                        required="false">
                        <f:passThroughAttribute
                            name="placeholder"
                            value="" />
                    </x:inputSecret>

                    <!-- Icons -->
                    <ui:include src="/uii/includes/form_icons.xhtml">
                        <ui:param
                            name="helpTitle"
                            value="#{msgs.plugin_rest_usercreation_new_account_password2}" />
                        <ui:param
                            name="helpBody"
                            value="#{msgs.plugin_rest_usercreation_helpText_password2}" />
                    </ui:include>

                </div>


                <!-- email address -->
                <div class="form #{!externalLoginBean.emailValid ? 'validate--danger' : ''}">

                    <zlb:label
                        labelFor="emailAddress"
                        labelText="#{msgs.plugin_rest_usercreation_new_account_emailAddress}"
                        labelRequired="true" />

                    <zlb:input
                        inputId="emailAddress"
                        inputAriaLabel="#{msgs.plugin_rest_usercreation_new_account_emailAddress}"
                        inputForceId="true"
                        inputValue="#{externalLoginBean.emailAddress}"
                        inputRequired="false"
                        inputPlaceholder="#{msgs.plugin_rest_usercreation_new_account_emailAddress}"
                        helpTitle="#{msgs.plugin_rest_usercreation_new_account_emailAddress}"
                        helpText="#{msgs.plugin_rest_usercreation_helpText_email}" />

                    <h:panelGroup
                        layout="block"
                        rendered="#{!externalLoginBean.emailValid}"
                        styleClass="font-danger validation-message">
                        <h:outputText value="#{externalLoginBean.emailErrorMessage}" />
                    </h:panelGroup>
                </div>




                <div class="form form-check confirm-privacy #{!externalLoginBean.privacyValid ? 'validate--danger' : ''}">

                    <div class="form-check-wrapper">
                        <h:selectBooleanCheckbox
                            id="privacyStatement"
                            pt:aria-label="#{msgs.plugin_rest_usercreation_new_account_confirmPrivacyStatement}"
                            forceId="true"
                            styleClass="form-check-input"
                            value="#{externalLoginBean.privacyTextAccepted}"
                            required="false">
                        </h:selectBooleanCheckbox>

                        <label
                            for="privacyStatement"
                            class="zlb-label">
                            <h:outputText
                                escape="false"
                                value="#{msgs.plugin_rest_usercreation_new_account_confirmPrivacyStatement}" />

                            <span
                                class="input-required"
                                jsf:rendered="true">
                                <i class="fa fa-asterisk" />
                            </span>

                        </label>

                        <h:panelGroup
                            layout="block"
                            rendered="#{!externalLoginBean.privacyValid}"
                            styleClass="font-danger validation-message">
                            <h:outputText value="#{externalLoginBean.privacyErrorMessage}" />
                        </h:panelGroup>
                    </div>
                    <!-- end form-check-wrapper -->


                    <!-- ICONS -->
                    <ui:include src="/uii/includes/form_icons.xhtml">
                        <ui:param
                            name="helpTitle"
                            value="#{msgs.plugin_rest_usercreation_helpTitle_privacy}" />
                        <ui:param
                            name="helpBody"
                            value="#{msgs.plugin_rest_usercreation_helpText_privacy}" />
                    </ui:include>

                </div>
            </section>
            <!-- end common-region -->

            <div class="info-required">
                <h:outputText
                    escape="false"
                    value="#{msgs.plugin_rest_usercreation_requiredFields}" />
            </div>

            <div class="form-actions form-actions--progress">
                <!-- cancel button -->
                <button
                    jsf:id="back"
                    class="btn btn-blank me-4"
                    jsf:immediate="true">
                    <f:setPropertyActionListener
                        value=""
                        target="#{externalLoginBean.uiStatus}" />
                    <h:outputText value="#{msgs.abbrechen}" />
                </button>

                <!-- create button -->
                <button
                    jsf:action="#{externalLoginBean.createAccount}"
                    jsf:id="create"
                    class="btn btn-success ms-auto">
                    <h:outputText value="#{msgs.plugin_rest_usercreation_new_account_createAccount}" />
                </button>
            </div>


            <div
                class="modal fade"
                id="privacyModal"
                aria-labelledby="#{msgs.plugin_administration_deliveryManagement_displayMode_privacyPolicy}"
                aria-hidden="true"
                tabindex="-1">
                <div class="modal-dialog modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                <h:outputText value="#{msgs.plugin_administration_deliveryManagement_displayMode_privacyPolicy}" />
                            </h5>
                            <button
                                type="button"
                                class="btn-close"
                                data-bs-dismiss="modal"
                                aria-label="#{msgs.close}"></button>
                        </div>
                        <div class="modal-body">
                            <h:outputText
                                value="#{externalLoginBean.privacyStatement}"
                                escape="false" />

                        </div>
                        <div class="modal-footer">
                            <button
                                type="button"
                                class="btn btn-secondary"
                                data-bs-dismiss="modal">
                                <h:outputText value="#{msgs.close}" />
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </ui:fragment>


        <ui:fragment rendered="#{externalLoginBean.wizzardMode=='confirm'}">

            <section class="common-region">
                <h:outputText
                    escape="false"
                    value="#{msgs.plugin_rest_usercreation_new_account_confirmEmail}" />
            </section>

            <button
                class="btn btn-primary-400 ms-auto"
                jsf:immediate="true"
                jsf:id="backToStart">
                <h:outputText value="#{msgs.plugin_rest_usercreation_backToLogin}" />
                <f:setPropertyActionListener
                    value=""
                    target="#{externalLoginBean.uiStatus}" />
                <f:setPropertyActionListener
                    value="page1"
                    target="#{externalLoginBean.wizzardMode}" />
            </button>


        </ui:fragment>

        <ui:fragment rendered="#{externalLoginBean.wizzardMode=='page2'}">

            <section class="common-region">


                <div class="form #{externalLoginBean.institutionNameInvalid ? 'validate--danger' : ''}">
                    <zlb:label
                        labelFor="institutionName"
                        labelText="#{msgs.plugin_rest_usercreation_new_account_institutionName}"
                        labelRequired="true" />

                    <zlb:input
                        inputId="institutionName"
                        inputAriaLabel="#{msgs.plugin_rest_usercreation_new_account_institutionName}"
                        inputForceId="true"
                        inputValue="#{externalLoginBean.institutionName}"
                        inputRequired="false"
                        inputPlaceholder="#{msgs.plugin_rest_usercreation_new_account_institutionNamePlaceholder}"
                        inputDuplicate="false"
                        showHelpBtn="true"
                        helpTitle="#{msgs.plugin_rest_usercreation_new_account_institutionName}"
                        helpText="#{msgs.plugin_rest_usercreation_helpText_institutionName}" />
                    <h:panelGroup
                        layout="block"
                        rendered="#{externalLoginBean.institutionNameInvalid}"
                        styleClass="font-danger validation-message">
                        <h:outputText value="#{msgs.plugin_rest_usercreation_new_account_institutionNameInvalid}" />
                    </h:panelGroup>
                </div>

                <ui:repeat
                    var="field"
                    value="#{externalLoginBean.additionalFields['page2']}"
                    varStatus="status">
                    <div class="form  #{status.index==0?'column-start':''} #{field.validationError ? 'validate--danger' : ''}">

                        <zlb:label
                            labelFor="input"
                            labelText="#{msgs[field.label]}"
                            labelRequired="#{field.required}" />


                        <x:inputText
                            id="input"
                            rendered="#{field.fieldType=='input'}"
                            pt:aria-label="#{field.label}"
                            styleClass="form-control"
                            value="#{field.value}">
                            <f:ajax
                                render="@this"
                                execute="@this" />
                            <f:passThroughAttribute
                                name="placeholder"
                                value="#{msgs[field.placeholderText]}" />
                        </x:inputText>

                        <x:inputTextarea
                            id="textarea"
                            rendered="#{field.fieldType=='textarea'}"
                            pt:aria-label="#{field.label}"
                            styleClass="form-control"
                            value="#{field.value}">
                            <f:ajax
                                render="@this"
                                execute="@this" />
                            <f:passThroughAttribute
                                name="placeholder"
                                value="#{msgs[field.placeholderText]}" />
                        </x:inputTextarea>
                        <h:selectOneMenu
                            id="dropdown"
                            rendered="#{field.fieldType=='dropdown'}"
                            styleClass="form-control"
                            value="#{field.value}"
                            pt:aria-label="#{field.label}">
                            <f:selectItem
                                itemValue="null"
                                itemLabel="#{msgs.bitteAuswaehlen}" />
                            <f:ajax
                                render="@this"
                                execute="@this" />
                            <f:selectItems value="#{field.selectItemList}" itemLabel="#{msgs[val]}" itemValue="#{val}" var="val" />
                        </h:selectOneMenu>
                        <h:selectBooleanCheckbox
                            rendered="#{field.fieldType=='checkbox' or field.fieldType=='combo'}"
                            pt:aria-label="#{field.label}"
                            styleClass="form-control"
                            value="#{field.booleanValue}">
                            <f:ajax
                                render="@form"
                                execute="@this" />
                        </h:selectBooleanCheckbox>
                        <h:selectOneRadio
                            id="radio"
                            rendered="#{field.fieldType=='combo' and field.booleanValue}"
                            styleClass="form-control"
                            value="#{field.subValue}"
                            required="true"
                            requiredMessage="#{field.validationErrorMessage}">
                            <f:ajax
                                render="@form"
                                execute="@this" />
                            <f:selectItems value="#{field.selectItemList}" itemLabel="#{msgs[val]}" itemValue="#{val}" var="val" />
                        </h:selectOneRadio>

                        <!-- ICONS -->
                        <ui:include src="/uii/includes/form_icons.xhtml">
                            <ui:param
                                name="helpTitle"
                                value="#{field.label}" />
                            <ui:param
                                name="helpBody"
                                value="#{field.helpMessage}" />
                        </ui:include>

                        <h:panelGroup
                            layout="block"
                            rendered="#{field.validationError}"
                            styleClass="font-danger validation-message">
                            <h:outputText value="#{field.validationErrorMessage}" />
                        </h:panelGroup>
                        <h:outputText
                            styleClass="help-block font-light"
                            rendered="#{NavigationForm.showHelp}"
                            value="#{field.helpMessage}" />

                    </div>
                </ui:repeat>
            </section>
        </ui:fragment>

        <ui:fragment rendered="#{externalLoginBean.wizzardMode=='page3'}">

            <div class="form">
                <div class="form-check-wrapper">
                    <h:selectBooleanCheckbox
                        id="contactPersonCheckbox"
                        pt:aria-label="#{msgs.plugin_rest_usercreation_new_account_userIsContactPerson}"
                        forceId="true"
                        styleClass="form-check-input"
                        value="#{externalLoginBean.userIsContactPerson}"
                        required="false">
                        <f:ajax
                            execute="@this"
                            render="@form" />
                    </h:selectBooleanCheckbox>
                    <zlb:label
                        labelFor="contactPersonCheckbox"
                        labelText="#{msgs.plugin_rest_usercreation_new_account_userIsContactPerson}"
                        labelHelpText=""
                        labelRequired="false" />
                </div>

            </div>
            <section class="common-region">

                <h3 class="heading__contact grid-full-width">#{msgs.plugin_rest_usercreation_new_contact}</h3>

                <ui:repeat
                    var="field"
                    value="#{externalLoginBean.additionalFields['page3']}">

                    <div class="form #{field.validationError ? 'validate--danger' : ''}">

                        <zlb:label
                            labelFor="input1"
                            labelText="#{msgs[field.label]}"
                            labelRequired="#{field.required}" />


                        <x:inputText
                            rendered="#{field.fieldType=='input'}"
                            pt:aria-label="#{field.label}"
                            styleClass="form-control"
                            value="#{field.value}">
                            <f:ajax
                                render="@this"
                                execute="@this" />
                            <f:passThroughAttribute
                                name="placeholder"
                                value="#{msgs[field.placeholderText]}" />
                        </x:inputText>


                        <x:inputTextarea
                            rendered="#{field.fieldType=='textarea'}"
                            pt:aria-label="#{field.label}"
                            styleClass="form-control"
                            value="#{field.value}">
                            <f:ajax
                                render="@this"
                                execute="@this" />
                            <f:passThroughAttribute
                                name="placeholder"
                                value="#{msgs[field.placeholderText]}" />
                        </x:inputTextarea>
                        <h:selectOneMenu
                            rendered="#{field.fieldType=='dropdown'}"
                            styleClass="form-control"
                            value="#{field.value}"
                            pt:aria-label="#{field.label}">
                            <f:selectItem
                                itemValue="null"
                                itemLabel="#{msgs.bitteAuswaehlen}" />
                            <f:ajax
                                render="@this"
                                execute="@this" />
                            <f:selectItems value="#{field.selectItemList}" itemLabel="#{msgs[val]}" itemValue="#{val}" var="val" />
                        </h:selectOneMenu>
                        <h:selectBooleanCheckbox
                            rendered="#{field.fieldType=='checkbox' or field.fieldType=='combo'}"
                            pt:aria-label="#{field.label}"
                            styleClass="form-control"
                            value="#{field.booleanValue}">
                            <f:ajax
                                render="@form"
                                execute="@this" />
                        </h:selectBooleanCheckbox>
                        <h:selectOneRadio
                            rendered="#{field.fieldType=='combo' and field.booleanValue}"
                            styleClass="form-control"
                            value="#{field.subValue}"
                            required="true"
                            requiredMessage="#{field.validationErrorMessage}">
                            <f:ajax
                                render="@form"
                                execute="@this" />
                            <f:selectItems value="#{field.selectItemList}" itemLabel="#{msgs[val]}" itemValue="#{val}" var="val" />
                        </h:selectOneRadio>

                        <!-- ICONS -->
                        <ui:include src="/uii/includes/form_icons.xhtml">
                            <ui:param
                                name="helpTitle"
                                value="#{field.label}" />
                            <ui:param
                                name="helpBody"
                                value="#{field.helpMessage}" />
                        </ui:include>

                        <h:panelGroup
                            layout="block"
                            rendered="#{field.validationError}"
                            styleClass="font-danger validation-message">
                            <h:outputText value="#{field.validationErrorMessage}" />
                        </h:panelGroup>
                        <h:outputText
                            styleClass="help-block font-light"
                            rendered="#{NavigationForm.showHelp}"
                            value="#{field.helpMessage}" />

                    </div>
                </ui:repeat>
            </section>

            <button
                jsf:rendered="#{!externalLoginBean.displaySecondContact}"
                jsf:id="createNewContact"
                jsf:action="#{externalLoginBean.createNewContact}"
                style="margin-bottom: 20px;"
                class="btn btn-link ms-auto">

                <ui:include src="/uii/includes/icon-plus.xhtml" />
                <span>
                    <h:outputText value="#{msgs.plugin_rest_usercreation_new_createNewContact}" />
                </span>
            </button>

            <section
                class="common-region"
                jsf:rendered="#{externalLoginBean.displaySecondContact}">

                <h3 class="heading__contact grid-full-width">
                    #{msgs.plugin_rest_usercreation_new_contact}
                    <button
                        jsf:id="disableContact"
                        jsf:action="#{externalLoginBean.disableContact}"
                        style="float: right"
                        class="btn btn-link ms-auto">

                        <span>
                            <h:outputText value="#{msgs.plugin_rest_usercreation_new_disableContact}" />
                        </span>
                    </button>
                </h3>

                <ui:repeat
                    var="field"
                    value="#{externalLoginBean.additionalFields['page3a']}">

                    <div class="form">

                        <zlb:label
                            labelFor="input1"
                            labelText="#{msgs[field.label]}"
                            labelRequired="#{field.required}" />


                        <x:inputText
                            rendered="#{field.fieldType=='input'}"
                            pt:aria-label="#{field.label}"
                            styleClass="form-control"
                            value="#{field.value}">
                            <f:ajax
                                render="@this"
                                execute="@this" />
                            <f:passThroughAttribute
                                name="placeholder"
                                value="#{msgs[field.placeholderText]}" />
                        </x:inputText>


                        <x:inputTextarea
                            rendered="#{field.fieldType=='textarea'}"
                            pt:aria-label="#{field.label}"
                            styleClass="form-control"
                            value="#{field.value}">
                            <f:ajax
                                render="@this"
                                execute="@this" />
                            <f:passThroughAttribute
                                name="placeholder"
                                value="#{msgs[field.placeholderText]}" />
                        </x:inputTextarea>
                        <h:selectOneMenu
                            rendered="#{field.fieldType=='dropdown'}"
                            styleClass="form-control"
                            value="#{field.value}"
                            pt:aria-label="#{field.label}">
                            <f:selectItem
                                itemValue="null"
                                itemLabel="#{msgs.bitteAuswaehlen}" />
                            <f:ajax
                                render="@this"
                                execute="@this" />
                            <f:selectItems value="#{field.selectItemList}" itemLabel="#{msgs[val]}" itemValue="#{val}" var="val" />
                        </h:selectOneMenu>
                        <h:selectBooleanCheckbox
                            rendered="#{field.fieldType=='checkbox' or field.fieldType=='combo'}"
                            pt:aria-label="#{field.label}"
                            styleClass="form-control"
                            value="#{field.booleanValue}">
                            <f:ajax
                                render="@form"
                                execute="@this" />
                        </h:selectBooleanCheckbox>
                        <h:selectOneRadio
                            rendered="#{field.fieldType=='combo' and field.booleanValue}"
                            styleClass="form-control"
                            value="#{field.subValue}"
                            required="true"
                            requiredMessage="#{field.validationErrorMessage}">
                            <f:ajax
                                render="@form"
                                execute="@this" />
                            <f:selectItems value="#{field.selectItemList}" itemLabel="#{msgs[val]}" itemValue="#{val}" var="val" />
                        </h:selectOneRadio>

                        <!-- ICONS -->
                        <ui:include src="/uii/includes/form_icons.xhtml">
                            <ui:param
                                name="helpTitle"
                                value="#{field.label}" />
                            <ui:param
                                name="helpBody"
                                value="#{field.helpMessage}" />
                        </ui:include>

                        <h:panelGroup
                            layout="block"
                            rendered="#{field.validationError}"
                            styleClass="font-danger validation-message">
                            <h:outputText value="#{field.validationErrorMessage}" />
                        </h:panelGroup>
                        <h:outputText
                            styleClass="help-block font-light"
                            rendered="#{NavigationForm.showHelp}"
                            value="#{field.helpMessage}" />

                    </div>
                </ui:repeat>
            </section>



        </ui:fragment>

        <ui:fragment rendered="#{externalLoginBean.wizzardMode=='page4'}">

            <section class="common-region additional-data">
                <ui:repeat
                    var="field"
                    value="#{externalLoginBean.additionalFields['page4']}">
                    <div class="form-group">


                        <ui:fragment rendered="#{field.fieldType=='checkbox' or field.fieldType=='combo'}">

                            <div class="form form-check">
                                <div class="form-check-wrapper">

                                    <h:selectBooleanCheckbox
                                        rendered="#{field.fieldType=='checkbox' or field.fieldType=='combo'}"
                                        pt:aria-label="#{field.label}"
                                        styleClass="form-control"
                                        value="#{field.booleanValue}">
                                        <f:ajax
                                            render="@form"
                                            execute="@this" />
                                    </h:selectBooleanCheckbox>

                                    <zlb:label
                                        labelFor="activation"
                                        labelText="#{msgs[field.label]}"
                                        labelHelpText=""
                                        labelEscapeText="#{false}"
                                        labelRequired="#{field.required}" />
                                </div>
                                <!-- end form-check-wraper -->

                                <!-- ICONS -->
                                <ui:include src="/uii/includes/form_icons.xhtml">
                                    <ui:param
                                        name="helpTitle"
                                        value="#{msgs.plugin_rest_usercreation_new_additionalData}" />
                                    <ui:param
                                        name="helpBody"
                                        value="#{field.helpMessage}" />
                                </ui:include>

                            </div>
                        </ui:fragment>

                        <i
                            jsf:rendered="#{field.required}"
                            class="fa fa-asterisk pull-right font-asterisk"
                            title="#{msgs.requiredField}"
                            data-toggle="tooltip" />
                        <div class="email controls">

                            <x:inputText
                                rendered="#{field.fieldType=='input'}"
                                pt:aria-label="#{field.label}"
                                styleClass="form-control"
                                value="#{field.value}">
                                <f:ajax
                                    render="@this"
                                    execute="@this" />
                                <f:passThroughAttribute
                                    name="placeholder"
                                    value="#{msgs[field.placeholderText]}" />
                            </x:inputText>
                            <x:inputTextarea
                                rendered="#{field.fieldType=='textarea'}"
                                pt:aria-label="#{field.label}"
                                styleClass="form-control"
                                value="#{field.value}">
                                <f:ajax
                                    render="@this"
                                    execute="@this" />
                                <f:passThroughAttribute
                                    name="placeholder"
                                    value="#{msgs[field.placeholderText]}" />
                            </x:inputTextarea>
                            <h:selectOneMenu
                                rendered="#{field.fieldType=='dropdown'}"
                                styleClass="form-select"
                                value="#{field.value}"
                                pt:aria-label="#{field.label}">
                                <f:selectItem
                                    itemValue="null"
                                    itemLabel="#{msgs.bitteAuswaehlen}" />
                                <f:ajax
                                    render="@this"
                                    execute="@this" />
                                <f:selectItems value="#{field.selectItemList}" itemLabel="#{msgs[val]}" itemValue="#{val}" var="val" />
                            </h:selectOneMenu>
                            <h:selectOneRadio
                                rendered="#{field.fieldType=='combo' and field.booleanValue}"
                                styleClass="form-control"
                                value="#{field.subValue}"
                            >
                                <f:ajax
                                    render="@form"
                                    execute="@this" />
                                <f:selectItems value="#{field.selectItemList}" itemLabel="#{msgs[val]}" itemValue="#{val}" var="val" />
                            </h:selectOneRadio>
                            <h:panelGroup
                                layout="block"
                                rendered="#{field.validationError}"
                                styleClass="font-danger validation-message">
                                <h:outputText value="#{field.validationErrorMessage}" />
                            </h:panelGroup>
                            <h:outputText
                                styleClass="help-block font-light"
                                rendered="#{NavigationForm.showHelp}"
                                value="#{fieldy.helpMessage}" />
                        </div>
                    </div>

                </ui:repeat>


            </section>


        </ui:fragment>

        <ui:fragment rendered="#{externalLoginBean.wizzardMode=='page5'}">

            <section class="common-region one-col overview">
                <!-- show all fields in read only mode -->
                <h3>
                    <h:outputText value="#{msgs.plugin_rest_usercreation_new_institution}" />
                </h3>
                <zlb:formOutputTxt
                    label="#{msgs.plugin_rest_usercreation_new_account_institutionName}"
                    field="#{externalLoginBean.institutionName}"
                    name="institutionName"
                    fieldStyle="form-control" />
                <ui:repeat
                    var="field"
                    value="#{externalLoginBean.additionalFields['page2']}">
                    <zlb:formOutputTxt
                        name="field"
                        label="#{field.label}"
                        field="#{field.value}"
                        fieldStyle="form-control" />
                </ui:repeat>
            </section>
            <section class="common-region one-col overview">
                <h3 class="heading__contact">
                    <h:outputText value="#{msgs.plugin_rest_usercreation_new_contact}" />
                </h3>
                <ui:repeat
                    var="field"
                    value="#{externalLoginBean.additionalFields['page3']}">
                    <zlb:formOutputTxt
                        name="field"
                        label="#{field.label}"
                        field="#{field.value}"
                        fieldStyle="form-control" />
                </ui:repeat>
                <ui:fragment rendered="#{externalLoginBean.displaySecondContact}">

                    <h3 class="heading__contact">
                        <h:outputText value="#{msgs.plugin_rest_usercreation_new_contact}" />
                    </h3>

                    <ui:repeat
                        var="field"
                        value="#{externalLoginBean.additionalFields['page3a']}">
                        <zlb:formOutputTxt
                            name="field"
                            label="#{field.label}"
                            field="#{field.value}"
                            fieldStyle="form-control" />
                    </ui:repeat>
                </ui:fragment>

            </section>
            <section class="common-region one-col overview">

                <h3>
                    <h:outputText value="#{msgs.plugin_rest_usercreation_new_additionalData}" />
                </h3>
                <ui:repeat
                    var="field"
                    value="#{externalLoginBean.additionalFields['page4']}">
                    <zlb:formOutputTxt
                        name="field"
                        label="#{field.label}"
                        field="#{field.value}"
                        fieldStyle="form-control"
                        classLeft="col-sm-12 col-md-10 flex-column"
                        classRight="col-sm-12 col-md-2"
                        showDisabledCheckBox="#{true}"
                        showDisabledCheckBoxActivated="#{field.value}"
                        secondValue="#{field.subValue}"/>
                </ui:repeat>

            </section>

            <!-- ANTRAG AUF FREISCHALTUNG -->

            <section class="common-region one-col overview highlight-border">
                <h3>
                    <h:outputText value="#{msgs.plugin_rest_usercreation_new_account_askForActivation}" />
                </h3>


                <div class="form form-check grid-full-width">
                    <div class="form-check-wrapper">
                        <h:selectBooleanCheckbox
                            id="activation"
                            pt:aria-label="#{msgs.plugin_rest_usercreation_new_account_activation}"
                            forceId="true"
                            styleClass="form-check-input"
                            value="#{externalLoginBean.activation}"
                            required="true">
                        </h:selectBooleanCheckbox>
                        <zlb:label
                            labelFor="activation"
                            labelText="#{msgs.plugin_rest_usercreation_new_account_activation}"
                            labelRequired="true" />
                    </div>
                    <!-- ICONS -->
                    <ui:include src="/uii/includes/form_icons.xhtml">
                        <ui:param
                            name="helpTitle"
                            value="#{msgs.plugin_rest_usercreation_new_account_askForActivation}" />
                        <ui:param
                            name="helpBody"
                            value="#{msgs.plugin_rest_usercreation_new_account_activation_helpMessage}" />
                    </ui:include>
                </div>
            </section>
        </ui:fragment>

        <!-- Account erfolgreich angelegt -->
        <ui:fragment rendered="#{externalLoginBean.wizzardMode=='wait'}">
            <section class="common-region one-col">
                <h:outputText
                    escape="false"
                    value="#{msgs.plugin_rest_usercreation_new_account_creationSuccessful}" />
            </section>


            <button
                class="btn btn-primary-400 ms-auto"
                jsf:immediate="true"
                jsf:id="backToStart2">
                <h:outputText value="#{msgs.plugin_rest_usercreation_backToLogin}" />
                <f:setPropertyActionListener
                    value=""
                    target="#{externalLoginBean.uiStatus}" />
                <f:setPropertyActionListener
                    value="page1"
                    target="#{externalLoginBean.wizzardMode}" />
            </button>

        </ui:fragment>

        <ui:fragment rendered="#{externalLoginBean.wizzardMode!='confirm' and externalLoginBean.wizzardMode!='wait'}">
            <div
                class="info-required"
                jsf:rendered="#{externalLoginBean.wizzardMode!='page1' and externalLoginBean.wizzardMode!='page4'}">
                <h:outputText
                    escape="false"
                    value="#{msgs.plugin_rest_usercreation_requiredFields}" />
            </div>
        </ui:fragment>


        <ui:fragment rendered="#{externalLoginBean.wizzardMode!='page1' and externalLoginBean.wizzardMode!='confirm' and externalLoginBean.wizzardMode!='wait'}">
                <!-- cancel button -->
                <button
                    jsf:id="cancel"
                    class="btn btn-blank me-4"
                    jsf:immediate="true">
                    <f:setPropertyActionListener
                        value=""
                        target="#{externalLoginBean.uiStatus}" />
                    <h:outputText value="#{msgs.abbrechen}" />
                </button>
            <div class="submit form-actions form-actions--progress">
                <button
                    jsf:rendered="#{externalLoginBean.wizzardMode!='page2'}"
                    jsf:action="#{externalLoginBean.back}"
                    jsf:id="goBack"
                    class="btn btn-blank me-auto">
                    <h:outputText value="#{msgs.plugin_rest_usercreation_back}" />
                </button>

                <ul class="statuslist">
                    <li class="#{externalLoginBean.wizzardMode=='page1'?'active':'finished'}">

                        <h:panelGroup styleClass="status #{externalLoginBean.wizzardMode=='page1'?'active':'finished'} ">
                            <h:outputText value="#{msgs.plugin_rest_usercreation_page1}" />
                        </h:panelGroup>
                    </li>
                    <li class="#{externalLoginBean.wizzardMode=='page2' ? 'active': 'finished'}">
                        <h:panelGroup styleClass="status #{externalLoginBean.wizzardMode=='page2' ? 'active': 'finished'}">
                            <h:outputText value="#{msgs.plugin_rest_usercreation_page2}" />
                        </h:panelGroup>
                    </li>
                    <li class="#{externalLoginBean.wizzardMode=='page3' ? 'active': externalLoginBean.wizzardMode=='page1' or externalLoginBean.wizzardMode=='page2' ? 'inactive': 'finished'}">
                        <h:panelGroup styleClass="status #{externalLoginBean.wizzardMode=='data2' ? 'active': externalLoginBean.wizzardMode=='page1' or externalLoginBean.wizzardMode=='page2' ? 'inactive': 'finished'}">
                            <h:outputText value="#{msgs.plugin_rest_usercreation_page3}" />
                        </h:panelGroup>
                    </li>
                    <li class="#{externalLoginBean.wizzardMode=='page4' ? 'active': externalLoginBean.wizzardMode=='page1' or externalLoginBean.wizzardMode=='page2' or externalLoginBean.wizzardMode=='page3' ? 'inactive': 'finished'}">
                        <h:panelGroup styleClass="status #{externalLoginBean.wizzardMode=='page4' ? 'active': externalLoginBean.wizzardMode=='page1' or externalLoginBean.wizzardMode=='page2' or externalLoginBean.wizzardMode=='page3' ? 'inactive': 'finished'}">
                            <h:outputText value="#{msgs.plugin_rest_usercreation_page4}" />
                        </h:panelGroup>
                    </li>

                    <li class="#{externalLoginBean.wizzardMode=='page5' ? 'active': externalLoginBean.wizzardMode=='confirm' ? 'finished': 'inactive'}">
                        <h:panelGroup styleClass="status #{externalLoginBean.wizzardMode=='page5' ? 'active': externalLoginBean.wizzardMode=='confirm' ? 'finished': 'inactive'}">
                            <h:outputText value="#{msgs.plugin_rest_usercreation_page5}" />
                        </h:panelGroup>
                    </li>
                </ul>

                <button
                    jsf:rendered="#{externalLoginBean.wizzardMode!='page5'}"
                    jsf:id="goNext"
                    jsf:action="#{externalLoginBean.next}"
                    class="btn btn-success ms-auto">
                    <h:outputText value="#{msgs.plugin_rest_usercreation_next}" />
                </button>
                <button
                    jsf:rendered="#{externalLoginBean.wizzardMode=='page5'}"
                    jsf:id="createInsitution"
                    jsf:action="#{externalLoginBean.createInstitution}"
                    class="btn btn-success ms-auto">
                    <h:outputText value="#{msgs.plugin_rest_usercreation_createInstitution}" />
                </button>
            </div>
        </ui:fragment>

    	  <ui:include src="../includes/helpModals.xhtml" />


<script>
function focusField (elem) {
// do nothing
}


var pwInput = document.querySelector('#password');
var pwInputConfirm = document.querySelector('#password2');

function comparePasswords() {
    const infoTextSucc = 'Die Passwörter stimmen überein.';
    const infoTextErr = '#{msgs.plugin_rest_usercreation_new_account_confirmPasswordWrong}';

    pwInput.parentElement.querySelector('.text-danger')?.remove();
    pwInput.parentElement.querySelector('.text-success')?.remove();
    const isEmpty = (pwInput.value === '' || pwInputConfirm.value === '');
    const isEqual = pwInput.value === pwInputConfirm.value;
    const infoEl = document.createElement('div');

    if (isEmpty) {
        pwInput.style.borderColor = 'var(--border-color)';
        pwInputConfirm.style.borderColor = 'var(--border-color)';
        return
    }

    if(isEqual) {
        pwInput.style.borderColor = 'var(--clr-success)';
        pwInputConfirm.style.borderColor = 'var(--clr-success)';
        infoEl.classList.add('text-success');
        infoEl.innerText = infoTextSucc;
        pwInput.parentElement.appendChild(infoEl);
        return
    }

    pwInput.style.borderColor = 'var(--clr-danger)';
    pwInputConfirm.style.borderColor = 'var(--clr-danger)';
    infoEl.classList.add('text-danger');
    infoEl.innerText = infoTextErr;
    pwInput.parentElement.appendChild(infoEl);


}

pwInput.addEventListener('keyup', comparePasswords)
pwInputConfirm.addEventListener('keyup', comparePasswords)


</script>

    </composite:implementation>

</ui:composition>
