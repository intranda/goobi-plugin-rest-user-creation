<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:x="http://myfaces.apache.org/tomahawk"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:o="http://omnifaces.org/ui"
    xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites"
    xmlns:jsf="http://xmlns.jcp.org/jsf">

    <composite:interface>
    </composite:interface>

    <composite:implementation>
        <main>
            <h:panelGroup layout="block"
                styleClass="wrapper wide"
                style="#{NavigationForm.uiStatus.loginStatus == 'accountCreation'? 'top: 30%' : 'top: 50%' } ">
                <h1>
                    <a href="index.xhtml">
                        <h:outputText
                            escape="false"
                            value="#{HelperForm.applicationHeaderTitle}" />
                    </a>
                </h1>

                <div
                    id="login-body"
                    class="login-body"
                    style="margin-bottom: 5px;">
                    <h:outputText
                        style="color:red;"
                        value="Developer Mode ON"
                        rendered="#{DevModeBean.developerMode}" />
                    <ui:fragment rendered="#{!LoginForm.oidcAutoRedirect}">
                        <h2>
                            <h:outputText
                                rendered="#{NavigationForm.uiStatus.loginStatus != 'accountCreation'}"
                                value="#{msgs.login}" />
                            <h:outputText
                                rendered="#{NavigationForm.uiStatus.loginStatus == 'accountCreation'}"
                                value="#{msgs.login_new_account}" />
                        </h2>
                        <h:form
                            styleClass="form-validate"
                            id="loginForm"
                            prependId="false">
                            <h:panelGroup id="globalWarningMessage">
                                <h:panelGroup
                                    rendered="#{SessionForm.logoutMessage!=''}"
                                    styleClass="alert alert-danger block"
                                    style="line-height:18px;font-size:14px;">
                                    <i class="fa fa-exclamation-triangle margin-right-10" />
                                    <h:outputText value="#{SessionForm.logoutMessage}" />
                                </h:panelGroup>
                            </h:panelGroup>

                            <h:messages
                                escape="false"
                                globalOnly="false"
                                errorClass="alert alert-danger"
                                infoClass="alert alert-info"
                                warnClass="alert"
                                showDetail="true"
                                showSummary="true"
                                tooltip="true"
                                styleClass="messagesLogin" />

                            <h:panelGroup rendered="#{NavigationForm.uiStatus.loginStatus != 'accountCreation'}">
                                <script type="text/javascript">
                                                                                                                                    window.onload = function() {
                                                                                                                                        document.getElementById( 'login' ).focus();
                                                                                                                                    }
                                                                                                                                </script>
                                <div class="form-group">
                                    <div class="email controls">
                                        <x:inputText
                                            id="login"
                                            pt:aria-label="#{msgs.login}"
                                            forceId="true"
                                            styleClass="form-control"
                                            value="#{LoginForm.login}">
                                            <f:passThroughAttribute
                                                name="placeholder"
                                                value="#{msgs.login}" />
                                        </x:inputText>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="pw controls">
                                        <x:inputSecret
                                            id="passwort"
                                            pt:aria-label="#{msgs.passwort}"
                                            forceId="true"
                                            styleClass="form-control"
                                            value="#{LoginForm.passwort}">
                                            <f:passThroughAttribute
                                                name="placeholder"
                                                value="#{msgs.passwort}" />
                                        </x:inputSecret>
                                    </div>
                                </div>
                                <div class="submit">
                                    <ui:fragment rendered="#{LoginForm.userCreationEnabled}">
                                        <button
                                            jsf:id="createAccount"
                                            class="float-left btn font-size-s"
                                            style="background: #fff; outline: 1px solid #368ee0;">
                                            <f:setPropertyActionListener
                                                value="accountCreation"
                                                target="#{NavigationForm.uiStatus.loginStatus}" />
                                            <h:outputText value="#{msgs.login_createAccount}" />
                                        </button>
                                    </ui:fragment>


                                    <ui:fragment rendered="#{LoginForm.useOpenIDConnect}">
                                        <button
                                            jsf:id="openIdLogin"
                                            jsf:action="#{LoginForm.openIDLogin}"
                                            class="float-left btn font-size-s"
                                            style="background: #fff; outline: 1px solid #368ee0;">OpenID connect</button>
                                    </ui:fragment>
                                    <button
                                        jsf:id="loginButton"
                                        jsf:action="#{LoginForm.Einloggen}"
                                        style="margin-bottom: 20px;"
                                        class="btn btn-primary font-size-s pull-right">
                                        <h:outputText value="#{msgs.einloggen}" />
                                        <f:setPropertyActionListener
                                            target="#{NavigationForm.aktuell}"
                                            value="a0" />
                                    </button>
                                </div>
                            </h:panelGroup>

                            <h:panelGroup rendered="#{NavigationForm.uiStatus.loginStatus == 'accountCreation'}">
                                <!-- account name -->
                                <div class="form-group">
                                    <h:outputLabel
                                        for="accountName"
                                        value="#{msgs.login_new_account_accountName}" />
                                    <div class="email controls">
                                        <x:inputText
                                            id="accountName"
                                            pt:aria-label="#{msgs.login_new_account_accountName}"
                                            forceId="true"
                                            styleClass="form-control"
                                            value="#{externalLoginBean.accountName}"
                                            required="true">
                                            <f:passThroughAttribute
                                                name="placeholder"
                                                value="#{msgs.login_new_account_accountName}" />
                                        </x:inputText>
                                    </div>
                                </div>
                                <!-- email address -->
                                <div class="form-group">
                                    <h:outputLabel
                                        for="emailAddress"
                                        value="#{msgs.login_new_account_emailAddress}" />
                                    <div class="email controls">
                                        <x:inputText
                                            id="emailAddress"
                                            pt:aria-label="#{msgs.login_new_account_emailAddress}"
                                            forceId="true"
                                            styleClass="form-control"
                                            value="#{externalLoginBean.emailAddress}"
                                            required="true">
                                            <f:passThroughAttribute
                                                name="placeholder"
                                                value="#{msgs.login_new_account_emailAddress}" />
                                        </x:inputText>
                                    </div>
                                </div>
                                <!-- firstname -->
                                <div class="form-group">
                                    <h:outputLabel
                                        for="firstname"
                                        value="#{msgs.firstname}" />
                                    <div class="email controls">
                                        <x:inputText
                                            id="firstname"
                                            pt:aria-label="#{msgs.firstname}"
                                            forceId="true"
                                            styleClass="form-control"
                                            value="#{externalLoginBean.firstname}">
                                            <f:passThroughAttribute
                                                name="placeholder"
                                                value="#{msgs.firstname}" />
                                        </x:inputText>
                                    </div>
                                </div> 
                                <!-- lastname -->
                                <div class="form-group">
                                    <h:outputLabel
                                        for="lastname"
                                        value="#{msgs.lastname}" />
                                    <div class="email controls">
                                        <x:inputText
                                            id="lastname"
                                            pt:aria-label="#{msgs.lastname}"
                                            forceId="true"
                                            styleClass="form-control"
                                            value="#{externalLoginBean.lastname}">
                                            <f:passThroughAttribute
                                                name="placeholder"
                                                value="#{msgs.lastname}" />
                                        </x:inputText>
                                    </div>
                                </div>

                                <!-- address -->
                                <div class="form-group">
                                    <h:outputLabel
                                        for="address"
                                        value="#{msgs.login_new_account_address}" />
                                    <div class="email controls">
                                        <x:inputTextarea
                                            id="address"
                                            pt:aria-label="#{msgs.login_new_account_address}"
                                            forceId="true"
                                            styleClass="form-control"
                                            value="#{externalLoginBean.address}">
                                            <f:passThroughAttribute
                                                name="placeholder"
                                                value="#{msgs.login_new_account_address}" />
                                        </x:inputTextarea>
                                    </div>
                                </div>
                                <div class="submit">
                                <!-- create button -->
                                <button
                                    jsf:action="#{externalLoginBean.createAccount}"
                                    jsf:id="create"
                                    class="pull-right btn font-size-s"
                                    style="background: #fff; outline: 1px solid #368ee0;">
                                    <h:outputText value="#{msgs.login_new_account_createAccount}" />
                                </button>
                                <!-- cancel button -->
                                <button
                                    jsf:id="back"
                                    class="float-left btn font-size-s"
                                    style="background: #fff; outline: 1px solid #368ee0;"
                                    jsf:immediate="true"
                                    >
                                    <f:setPropertyActionListener
                                        value=""
                                        target="#{NavigationForm.uiStatus.loginStatus}" />
                                    <h:outputText value="#{msgs.abbrechen}" />
                                </button>
                                </div>
                            </h:panelGroup>

                        </h:form>
                        <o:socket channel="adminMessageChannel">
                            <f:ajax
                                event="update"
                                render="loginForm openIdForm" />
                        </o:socket>
                    </ui:fragment>
                    <ui:fragment rendered="#{LoginForm.oidcAutoRedirect}">
                        <h:form id="openIdForm">
                            <div
                                class="text-center"
                                style="padding: 32.5px 0">
                                <h2>
                                    <h:outputText value="Redirecting to SSO provider..." />
                                </h2>
                                <p>If this doesn't work, click this button:</p>
                                <button
                                    jsf:id="openIdLink"
                                    jsf:action="#{LoginForm.openIDLogin}"
                                    class="float-left btn font-size-s"
                                    style="background: #fff; outline: 1px solid #368ee0; margin-bottom: 20px;">OpenID connect</button>
                                <script>
                                                                                                                                    $( document )
                                                                                                                                            .ready( function() {
                                                                                                                                                console
                                                                                                                                                        .log( $( '#openIdForm\\:openIdLink' ) );
                                                                                                                                                setTimeout( function() {
                                                                                                                                                    $( '#openIdForm\\:openIdLink' )
                                                                                                                                                            .click();
                                                                                                                                                }, 1000 )
                                                                                                                                            } )
                                                                                                                                </script>
                            </div>
                        </h:form>
                    </ui:fragment>
                    <ui:fragment rendered="#{LoginForm.useHeaderLogin}">
                        <h:form id="headerSsoForm">
                            <button
                                jsf:id="headerSsoLink"
                                jsf:action="#{LoginForm.headerSsoLogin}"
                                class="float-left btn font-size-s"
                                style="display: none;"></button>
                            <script>
                                                                                                                    $( document ).ready( function() {
                                                                                                                        setTimeout( function() {
                                                                                                                            $( '#headerSsoForm\\:headerSsoLink' ).click();
                                                                                                                        }, 300 )
                                                                                                                    } )
                                                                                                                </script>
                        </h:form>
                    </ui:fragment>
                </div>
                <a
                    style="color: #FFFFFF;"
                    href="https://goobi.io/">Goobi workflow - developed by intranda</a>

                <h:outputText
                    style="color:#FFFFFF;"
                    styleClass="pull-right"
                    value="#{msgs.version} #{HelperForm.version}" />

            </h:panelGroup>
        </main>
    </composite:implementation>


</ui:composition>



